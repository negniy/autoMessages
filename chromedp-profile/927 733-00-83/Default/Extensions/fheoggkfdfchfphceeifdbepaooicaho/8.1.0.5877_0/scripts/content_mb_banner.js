/*!
 * 
 *     MCAFEE RESTRICTED CONFIDENTIAL
 *     Copyright (c) 2025 McAfee, LLC
 *
 *     The source code contained or described herein and all documents related
 *     to the source code ("Material") are owned by McAfee or its
 *     suppliers or licensors. Title to the Material remains with McAfee
 *     or its suppliers and licensors. The Material contains trade
 *     secrets and proprietary and confidential information of McAfee or its
 *     suppliers and licensors. The Material is protected by worldwide copyright
 *     and trade secret laws and treaty provisions. No part of the Material may
 *     be used, copied, reproduced, modified, published, uploaded, posted,
 *     transmitted, distributed, or disclosed in any way without McAfee's prior
 *     express written permission.
 *
 *     No license under any patent, copyright, trade secret or other intellectual
 *     property right is granted to or conferred upon you by disclosure or
 *     delivery of the Materials, either expressly, by implication, inducement,
 *     estoppel or otherwise. Any license under such intellectual property rights
 *     must be expressed and approved by McAfee in writing.
 *
 */(()=>{"use strict";const e="SEND_TELEMETRY",t="SHOW_MB_SIDEBAR",n="MB_VIDEO_FLAGGED",i="PING_CONTENT_MB_BANNER",s="MB_BANNER_SHOW",o="MB_BANNER_REMOVE",a="BROADCAST_MB_UPDATE_UI",r={NONE:0,LINKEDIN:1,INSTAGRAM:2,YOUTUBE:4,FACEBOOK:8,TWITTER:16,REDDIT:32},l=(Object.values(r).reduce(((e,t)=>e+t)),{NONE:"NONE",ONLY_SECURE_SEARCH:"ONLY_SECURE_SEARCH",ALL:"ALL",*[Symbol.iterator](){for(const e of Object.keys(this))yield e}}),{NONE:c,..._}=r,d={name:"BLOCK_PAGE_WHITELIST",type:"array"},p={name:"POPUP_STATS",type:"object"},E={name:"RAT_DETECTION_WHITELIST",type:"array"},m={name:"LAST_ANTITRACKER_SCAN_RESULT",type:"object"},u={name:"ANTITRACKER_UPSELL_TASK",type:"object"},g={name:"FINGER_PRINT",type:"number"},T={name:"FIRST_PARTY",type:"number"},h={name:"THIRD_PARTY",type:"number"},N={name:"TRACKER_DOMAIN_LIST",type:"array"},A={name:"ANTITRACKER_WHITELIST",type:"array"},y={name:"TYPOSQUATTING_WHITELIST",type:"array"},S={name:"CACHE_TAB_DATA",type:"object"},I=chrome,b={GREEN:0,YELLOW:1,RED:2,GREY:3,HACKERSAFE:4,TYPOSQUATTING:5,PHISHING:6,*[Symbol.iterator](){for(const e of Object.keys(this))"GREEN"!==e&&"GREY"!==e&&(yield this[e])}},C=1,D=2,O=3,f=0,w=1,L=3,v=2,R="1.0.0.37",B=-1,k=0,P=1,M=2,F=3,U=70,K=31,V=16,x=1,H=(e,t)=>Array.from(Array(t+1).keys()).slice(e),G=I.runtime.getURL(""),W={fingerPrintDomains:g.name,firstParty:T.name,thirdPartyTrackers:h.name},$="snoozed",q="enabled";const Y=e=>{"undefined"!=typeof document&&null!==document&&("complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?e():document.addEventListener("DOMContentLoaded",e))};const z=0,j="PRINT_IN_BACKGROUND",X={NONE:0,INFO:1,ERROR:2,WARN:3,DEBUG:4,ALL_IN_BACKGROUND:99},Q=1,J=2,Z=3,ee=4,te={BACKGROUND:"BACKGROUND",CONTENT:"CONTENT",TELEMETRY:"TELEMETRY"},ne={DEFAULT:"color: #000000; font-weight: normal; font-style:normal; background: #FFFFFF;",BACKGROUND:"color: #8D0DBA; font-weight: bold; background: #FFFFFF;",CONTENT:"color: #F54A26; font-weight: bold; background: #FFFFFF;",TELEMETRY:"color: #147831; font-weight: bold; background: #FFFFFF;"};const ie=new class{constructor(){this.storageChecked=!1,this.logLevel=null,this.queue=[];const e="MCLOGLEVEL";chrome?.storage?.local.get([e]).then((t=>{const n=Object.values(X).includes(t[e]);this.logLevel=n?t[e]:z,this.logLevel!==X.NONE&&this.queue.forEach((({callback:e,message:t,processType:n})=>{e(t,n)})),this.queue=[],this.storageChecked=!0}))}log(e,t=null){this.storageChecked?this.processLog(e,Q,t,this.logLevel):this.queue.push({callback:this.log.bind(this),message:e,processType:t})}error(e,t=null){this.storageChecked?this.processLog(e,J,t,this.logLevel):this.queue.push({callback:this.error.bind(this),message:e,processType:t})}warn(e,t=null){this.storageChecked?this.processLog(e,Z,t,this.logLevel):this.queue.push({callback:this.warn.bind(this),message:e,processType:t})}debug(e,t=null){this.storageChecked?this.processLog(e,ee,t,this.logLevel):this.queue.push({callback:this.debug.bind(this),message:e,processType:t})}processLog(e,t,n,i){if(i===X.NONE)return;let s="chrome-extension:"===location.protocol?te.BACKGROUND:te.CONTENT;n&&te[n]&&(s=n);const o=new Date,a=t===J?e:`%c[${s} ${o.toLocaleString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}]: %c${e}`;s===te.CONTENT&&this.logLevel===X.ALL_IN_BACKGROUND&&chrome.runtime.sendMessage({command:j,logMessage:a,processType:s,logType:t,logLevel:i}),this.printLog(a,s,t,i)}printLog(e,t,n,i){const s=ne.DEFAULT,o=ne[t]||s;if(i>=X.ERROR&&n===J&&console.error(e),i>=X.INFO&&n===Q&&console.log(e,o,s),i>=X.WARN&&n===Z){const t="color: #FFA500; font-family: sans-serif; font-weight: bolder; text-shadow: #000 1px 1px;";console.log(`%cWARN - ${e}`,t,o,s)}if(i>=X.DEBUG&&n===ee){const t="color: #FF33D7; font-family: sans-serif; font-weight: bolder; text-shadow: #000 1px 1px;";console.log(`%cDEBUG - ${e}`,t,o,s)}}},se=(e,t=null,n)=>{"function"==typeof n?chrome.runtime.onMessage.addListener(((i,s,o)=>{if(s.id===chrome.runtime.id&&"object"==typeof i&&!Array.isArray(i)&&i?.ipcId===e)return n({promises:t,request:i,sender:s,sendResponse:o})})):ie.error("Provided with invalid callback function")};class oe{constructor(e){this.pingCommand=e,this.basePingListener(),this.addIdentifier()}basePingListener(e=null){se("WA",null,(({request:t,sendResponse:n})=>{const{command:i}=t;if(i===this.pingCommand)return ie.debug(`File Injection [pinged]: Received ${i} command`),n({content:!0}),"function"==typeof e&&e(),!0}))}addIdentifier(){Y((()=>{const e=document.createElement("span");e.id=this.pingCommand,e.style.cssText="display:none",document.body.appendChild(e)}))}}const ae=async(e,t,n,i)=>{try{chrome.tabs.sendMessage(i,{ipcId:e,command:t,...n},{},(()=>{chrome.runtime.lastError}))}catch(e){ie.warn(`[broadcast] Unexpected error when calling command: "${t}", err: ${e.message}`)}},re=(e,t,n,i,s=null)=>{if(!chrome.tabs)throw new Error('"tabs" permission not set in manifest.');const o={};return"number"==typeof s&&(o.frameId=s),chrome.tabs.sendMessage(i,{ipcId:e,command:t,...n},o)},le=(e,t={},n)=>(async(e,t,n={},i={})=>{try{if(i?.tabId){const{tabId:s,frameId:o}=i;return await re(e,t,n,s,o)}if(i?.broadcast){const s=await chrome.tabs.query({}),{broadcastIgnoreId:o=[]}=i;return s.filter((({id:e})=>!o.includes(e))).forEach((({id:i})=>{ae(e,t,n,i)})),!0}return await chrome.runtime.sendMessage({ipcId:e,command:t,...n})}catch(e){return ie.warn(`Unexpected error when calling command: "${t}", err: ${e.message}`),null}})("WA",e,t,n);class ce{static geti18nRes(e,t=[]){let n=I.i18n.getMessage(e,t);const i=I.i18n.getMessage("res_PRODUCT_NAME_TRADEMARKED");return n=n.replace(/%PRODUCTNAME%/g,i),n}static getResStr(e,t){const n=ce.geti18nRes(e);t("??"===n?"":n)}static async getFileSource(e){try{return(await fetch(I.runtime.getURL(e))).text()}catch(e){return""}}}class _e{constructor(e=null,t=document){if(this.resourcerequestor=ce,this.document=t,e){const t=this.document.querySelectorAll(`#${e}`);t&&(this.document=t[0].contentDocument)}this.localeData=this.localeData.bind(this),this.fillText=this.fillText.bind(this),this.fillLocalizedTexts=this.fillLocalizedTexts.bind(this),this.fillInputPlaceHolders=this.fillInputPlaceHolders.bind(this)}localeData(e,t=[]){return this.resourcerequestor.geti18nRes(e,t)}fillText(e,t){const n=this.document.getElementById(e);if(n){const e=n.getAttribute("x-mcinsertposition");if(e)return void n.insertAdjacentText(e,t);n.textContent=t,n.setAttribute("x-mcl10nprocessed",!0)}}fillLocalizedTexts(){for(const{id:e}of this.document.querySelectorAll("*[x-mclocalizedtext]:not([x-mcl10nprocessed=true])")){const t=this.localeData(e);if(null==t)return!1;this.fillText(e,t)}return!0}fillInputPlaceHolders(){for(const{id:e}of this.document.querySelectorAll("*[x-inputplaceholder]")){const t=this.localeData(e),n=this.document.getElementById(e);if(null==t)return!1;null!=n&&n.setAttribute("placeholder",t)}return!0}init(){this.fillLocalizedTexts(),this.fillInputPlaceHolders()}}const de=e=>{let{top:t,left:n}=pe(e);return t<0&&(t=0),n<0&&(n=0),{top:t,left:n}},pe=e=>{const t=e.getBoundingClientRect(),n=window.pageYOffset||window.scrollY,i=window.pageXOffset||window.scrollX;return{top:Math.round(t.top+n),left:Math.round(t.left+i),bottom:Math.round(t.bottom+n),right:Math.round(t.right+i)}},Ee="NO_VIDEO_PLAYING",me="NO_AUDIO_PLAYING",ue="FEATURE_OFF",ge="DISPLAYED";const Te="unknown",he={EVENT_NAME:"wa_deepfake_detection",EVENT_ID:"wa_deepfake_detection"},Ne="screen",Ae="event",ye="ai_audio_detected",Se="ai_audio_not_detected",Ie="no_suite",be="unable_read_csp_id",Ce="impression",De="accepted",Oe="faq_request",fe="closed",we="fades_away",Le="expand",ve="snoozed",Re="back_to_entry",Be="support_request",ke="back_to_deepfake_side_panel",Pe={ACTIVATION_ENROLLMENT_BANNER:"wa_deepfake_activation_enrollment_banner",ACTIVATION_ENROLLMENT_BANNER_SUCCESS:"wa_deepfake_activation_success",AI_ANNOTATION_BANNER:"wa_deepfake_banner_annotation",SIDEBAR_PANEL:"wa_deepfake_side_panel",SIDEBAR_FAQ_PANEL:"wa_deepfake_faq"},Me={EMBEDED_BANNER:"embedded",PAGE_BANNER:"page",AI_ANNO_FULL_BANNER:"banner_only",AI_ANNO_HOVER_BANNER:"icon_and_banner_on_hover",AI_ANNO_ICON_BANNER:"icon_only"},Fe={AUDIO_PLAYING:"audio_playing",X_CLICKED:"x_clicked",ACTIVATE_BTN_CLICKED:"activate_button_clicked",ACTIVATION_LEARM_MORE_CLICKED:"learn_more_clicked",ACTIVATION_ACCEPT:"deepfake_activation_accepted",ANNO_BANNER_CLICKED:"banner_clicked",ANNO_BANNER_FADE_AWAY:"time_elapsed",ANNO_BANNER_HOVER:"banner_hover",ANNO_BANNER_CLICKED_FOR_SIDEBAR:"deepfake_banner_annotation_clicked",MAIN_SIDEBAR_DFD_CLICKED:"sidebar_panel_deepfake_icon_clicked",FAQ_PANEL_BACK_CLICKED:"back_from_faq_clicked",SNOOZE_OPTION_SELECTED:"snooze_option_selected",AUDIO_DETECTION_TOGGLE_BTN_CLICKED:"audio_detection_toggle_switched",DFD_PANEL_BACK_CLICKED:"back_button_clicked",DFD_PANEL_BASICS_BTN_CLICKED:"deepfake_basics_button_clicked",DFD_PANEL_BUY_BTN_CLICK:"buy_now_button_clicked",DFD_PANEL_ON_TRIAL_BUY_BTN_CLICK:"buy_now_on_trial_clicked",DFD_FAQ_PANEL_SUPPORT_BTN_CLICKED:"contact_support_link_clicked",DFD_FAQ_PANEL_BACK_CLICKED:"back_button_clicked"},Ue={NO_ACTION:"no_action",WA_INTERACTION:"wa_interaction"},Ke={GENERIC_ERR:"generic_error",NO_AUDIO_PLAYING:"no_audio_playing",NO_VIDEO_PLAYING:"no_video_playing",DETECTION_OFF:"detection_off",NOTIFICATION_PAUSE:"notification_paused",GRAPH_DISPLAYED:"graph_displayed"};class Ve{static toTlmWpsCspClientId(e){let t=e;return null===t?t=Ie:void 0===t&&(t=be),t}static toTlmAudioGraphStatus(e,t){let n=Ke.NOTIFICATION_PAUSE;if(t)return n;if(n=Ke.GENERIC_ERR,!e)return n;switch(e){case Ee:n=Ke.NO_VIDEO_PLAYING;break;case me:n=Ke.NO_AUDIO_PLAYING;break;case ue:n=Ke.DETECTION_OFF;break;case ge:n=Ke.GRAPH_DISPLAYED}return n}static toTlmActivatedDays(e){let t=Te;if(e<=0)return t;const n=Date.now()-e;return t=Math.ceil(n/864e5),t}}const xe="whitelist",He="preference",Ge="statistics",We="about",$e="Block_Page",qe="BrowserAction_Clicked",Ye="Browser_Navigate",ze="DarkWebMonitoring",je="ProfileInfo",Xe="RemoteAccessTrojan",Qe="Secure_Search_Hit",Je="SideBar_Panel",Ze="wa_site_report_impression",et="SMA_Reputation",tt="Typosquatting",nt="WSS_Analytics",it={EVENT_NAME:"AdvancedProtectionSignals",IMPRESSION_BALLOON:"IMPRESSION_BALLOON",IMPRESSION_HOVER:"IMPRESSION_HOVER",CLOSE_BALLOON:"CLOSE_BALLOON",TOAST_CLOSE:"TOAST_CLOSE",TOAST:"toast",BALLOON:"balloon"},st="BrowserActionClicked",ot="Typosquatting",at="BlockPage",rt="SecureSearchHit",lt="SideBarPanel",ct="SMAReputation",_t="Impression",dt="WebAdvisor",pt={MAIN:"Main"},Et="CloseClicked",mt={ACKNOWLEDGED:"Acknowledged",WHITELISTED:"Whitelisted"},ut="AcceptRisk",gt="Close",Tt="GotIt",ht="Hover",Nt="About",At="Preferences",yt="Whitelist",St="UserStatistics",It="Green",bt="Yellow",Ct="Red",Dt="Grey",Ot="UNKNOWN",ft="Typosquatting",wt="Phishing",Lt="DefaultSearch",vt={CLICK:"click",KEYDOWN:"keydown",RETURN_KEY_CODE:13,SHOW:"show",SEARCH_SUGGEST_KEY_CODES:[8,32,46,...H(48,57),...H(65,90),...H(96,107),...H(109,111),...H(186,192),...H(219,222)]},Rt={LOADED:"Loaded",CHECKED:"checked",UNKNOWN:"UNKNOWN",ACTION_PANEL:"ActionPanel",ACCEPTED:"Accepted",DECLINED:"Declined",SETTINGS_TAB_PREFIX:"settings_tab_",GREEN:"GREEN",YELLOW:"YELLOW",RED:"RED",PREFERENCE:"Preference",DEFAULT:"default"};class Bt{static toTelemetryBlockState(e){let t=Ot;switch(e){case b.GREEN:t=It;break;case b.YELLOW:t=bt;break;case b.RED:t=Ct;break;case b.GREY:t=Dt;break;case b.TYPOSQUATTING:t=ft;break;case b.PHISHING:t=wt}return t}static toTelemetrySettingTab(e){let t=At;switch(e){case xe:t=yt;break;case Ge:t=St;break;case We:t=Nt}return t}}class kt{static PreprocessSecureSearchRegEx(e){return e.trim().split("\n")}static getBrowserSuffix(){const{CH:e,FF:t,EDGE:n}={CH:"_ch",FF:"_ff",IE:"_ie",EDGE:"_ed"},i={};return i[O]=n,i[C]=t,i[D]=e,i[v]}}const{SYSTEM:Pt,USER:Mt}={SYSTEM:0,USER:1},Ft=kt.getBrowserSuffix(),Ut={DEV_MODE:{scope:Pt,name:"dev_mode",value:!1},AFF_ID:{scope:Pt,name:"*Affid",value:0},BINARY_VERSION:{scope:Pt,name:"version",value:null},EXTENSION_VERSION_CH:{scope:Pt,name:"ChromeExtVersion",value:"",writeOnly:!0},EXTENSION_VERSION_FF:{scope:Pt,name:"*FirefoxXPIVersion",value:"",writeOnly:!0},EXTENSION_VERSION_ED:{scope:Pt,name:"EdgeExtVersion",value:"",writeOnly:!0},BROWSER_TYPE:{scope:Pt,name:"browsertype",value:"",writeOnly:!0},USER_AGENT:{scope:Pt,name:"useragent",value:"",writeOnly:!0},SUGGESTION_URL:{scope:Pt,name:"suggestion_url",value:""},SCRIPT_GENERATED_DEFAULT_SS_URL:{scope:Mt,name:`SCRIPT_GENERATED_DEFAULT_SS_URL${Ft}`,value:""},SECURE_SEARCH_REGEXES:{scope:Mt,name:"SECURE_SEARCH_REGEXES",value:"",preprocess:kt.PreprocessSecureSearchRegEx},SHOW_SEARCH_SETTINGS:{scope:Pt,name:"*ShowSearchSettings",value:!0},SECURE_SEARCH_TOAST_STAMP:{scope:Mt,name:`*SSDateStampShowedToast${Ft}`,value:0},SECURE_SEARCH_ANNOTATION_ONLY:{scope:Pt,name:"*OnlyShowAnnotationsOnSecureSearch",value:!0},SECURE_SEARCH_SHOW_ICONS:{scope:Mt,name:"*Icons",value:!0},SECURE_SEARCH_CHOICE:{scope:Mt,name:`*SSToastChoice${Ft}`,value:!1},SS_DEF:{scope:Pt,name:`*SS_DEF${Ft}`,value:0},ANNOTATIONS_CHOICE_EXPLICIT:{scope:Pt,name:`*AnnotationsChoiceExplicit${Ft}`,value:!1},CURRENT_SAO_IN_EXTENSION:{scope:Mt,name:`*CurrentSAOInExtension${Ft}`,value:""},FF_EXTENSION_LAST_TOAST_TIME:{scope:Mt,name:"ff_extension_last_toast_time",value:0,writeOnly:!0},FF_EXTENSION_TOAST_COUNT:{scope:Mt,name:"ff_extension_toast_count",value:0,writeOnly:!0},CHECKLIST_START_INGORE_DATE_AV:{scope:Pt,name:"startIgnoreDateAV",value:"",writeOnly:!0},CHECKLIST_START_IGNORE_DATE_FW:{scope:Pt,name:"startIgnoreDateFW",value:"",writeOnly:!0},CHECKLIST_IGNORE_DURACTION:{scope:Pt,name:"ignoreDuration",value:"14",writeOnly:!0},CHECKLIST_GRACE_PERIOD_AV:{scope:Pt,name:"fixGracePeriodStartDateAV",value:"",writeOnly:!0},CHECKLIST_GRACE_PERIOD_FW:{scope:Pt,name:"fixGracePeriodStartDateFW",value:"",writeOnly:!0},CHECKLIST_GRACE_PERIOD_DURATION:{scope:Pt,name:"fixGracePeriodDuration",value:"24",writeOnly:!0},CRYPTOJACKING_DISABLED:{scope:Pt,name:"CryptojackingDisabled",value:!0},SMA_USER_TOGGLE:{scope:Pt,name:`sma_user_toggle${Ft}`,value:!1,writeOnly:!0},SMA_ANNOTATION_OPTIONS:{scope:Pt,name:`sma_annotation_options${Ft}`,value:0,writeOnly:!0},PAGES_SCANNED:{scope:Pt,name:"*CounterPagesScanned",value:0},PAGES_BLOCKED:{scope:Pt,name:"*CounterPagesBlocked",value:0},DOWNLOADS_SCANNED:{scope:Pt,name:"*CounterDownloadsScanned",value:0},DOWNLOADS_BLOCKED:{scope:Pt,name:"*CounterDownloadsBlocked",value:0},BLOCKPAGE_WHITELIST:{scope:Mt,name:"*WhiteList",value:""},TS_WHITELIST:{scope:Mt,name:"*TListWhiteList",value:""},CSP_ID_SETTING:{scope:Pt,name:"CSPIdValue",value:"__not_available__"},MTI_CLIENT_ID:{scope:Pt,name:"gti_client_id",value:""},JWT_TOKEN_ENABLED:{scope:Pt,name:"jwt_token_enabled",value:!1},UNINSTALL_SURVEY_ENABLED:{scope:Pt,name:"uninstall_survey_enabled",value:!1},UNINSTALL_SURVEY_URL:{scope:Pt,name:"uninstall_survey_url",value:""},RAT_DETECTION_ENABLED:{scope:Pt,name:"rat_detection_enabled",value:!0},IDPS_FEATURE_ENABLED:{scope:Pt,name:"idps_feature_enabled",value:0},APS_COHORT:{scope:Pt,name:"aps_cohort",value:0},APS_TOGGLE_SETTING:{scope:Pt,name:"aps_toggle_setting",value:!0},ALT_TRIGGER:{scope:Pt,name:"alt_triggers_cohort",value:0},ANNOTATION_JOURNEY_COHORT:{scope:Pt,name:`annotation_journey_cohort${Ft}`,value:0},ANNOTATION_JOURNEY_TOAST:{scope:Mt,name:`aj_toast${Ft}`,value:null},DAILY_GREEN_URLS_TO_COLLECT:{scope:Pt,name:"daily_green_urls_to_collect",value:0},FEATURE_COLLECTION_ENABLED:{scope:Pt,name:"feature_collection_enabled",value:!1},DAILY_GREEN_URLS_RESET_RATE:{scope:Pt,name:"daily_green_urls_reset_rate",value:0},HERON_REPORT_ENABLED:{scope:Pt,name:"heron_report_enabled",value:!1},SAMPLING_RATE_BLOCK_DEFAULT:{scope:Pt,name:"sampling_rate_block_default",value:100},SAMPLING_RATE_USER_FEEDBACK:{scope:Pt,name:"sampling_rate_user_feedback",value:1},WA_EXTN_UUID:{scope:Mt,name:`wa_extn_uuid${Ft}`,value:"",writeOnly:!0},MOCKINGBIRD_ENABLED:{scope:Pt,name:"mockingbird_enabled",value:!0},TYPOSQUAT_ENABLED:{scope:Pt,name:"typosquat_enabled",value:!0},DFD_FEEDBACK_ENABLED:{scope:Pt,name:"dfd_feedback_enabled",value:!1}};class Kt{static getResetValues(){return{blockedIframes:[],tabDomainTrusted:!1,mockingbird:{},mbVideoId:null}}static getDefaultValues(){return Kt.getResetValues()}reset(e){const t=tn.localStore.get(S.name,{}),n=t[e]&&t[e].blockedIframes&&Object.keys(t[e].blockedIframes).length>0;tn.htiReportHandler.checkBacklog(e,t[e],n),this.update(e,Kt.getResetValues())}get(e){return tn.localStore.get(S.name,{})[e]||Kt.getDefaultValues()}set(e,t){const n=tn.localStore.get(S.name,{});n[e]=t,tn.localStore.set(S.name,n)}delete(e){const t=tn.localStore.get(S.name,{}),n=t[e]&&t[e].blockedIframes&&Object.keys(t[e].blockedIframes).length>0;tn.htiReportHandler.checkBacklog(e,t[e],n),delete t[e],tn.localStore.set(S.name,t)}update(e,t){const n=this.get(e);this.set(e,{...n,...t})}setTabBlockPageData(e,t,n=!0){const i={...this.get(e),blockPageData:t};this.set(e,i),n&&!t.url.includes("chrome://extensions/")&&tn.htiReportHandler.addReportToBacklog(e,i)}addBlockedFrame(e,t){const n=this.get(e);n.blockedIframes.push(t),this.update(e,n),tn.htiReportHandler.addIFrameReportToBacklog(e,n)}getBlockedFrames(e){return this.get(e).blockedIframes}resetBlockedFrames(e){const t=this.get(e);t.blockedIframes=[],this.update(e,t)}}const Vt="ph",xt="www.siteadvisor.com/",Ht="https://mip.api.mcafeewebadvisor.com/v1/typosquatting?",Gt="https://sadownload.mcafee.com/products/SA/Win/extensions/engines/update.json",Wt="https://sadownload.mcafee.com/products/SA/Win/extensions/sailor/condition.json",$t="https://sadownload.mcafee.com/products/SA/Win/extensions/antitracker/all_trackers.json",qt="https://threat.api.mcafee.com/",Yt="https://sadownload.mcafee.com/products/SA/Win/extensions/waextension/condition.json",zt="https://sadownload.mcafee.com/products/SA/Win/extensions/waextension/featureflag",jt=new Set(["www.mcafee.com"]),Xt="PAGES_SCANNED",Qt="PAGES_BLOCKED",Jt="DOWNLOADS_SCANNED",Zt="DOWNLOADS_BLOCKED";class en{static init(){const e=this.read(),{PAGES_SCANNED:t,PAGES_BLOCKED:n,DOWNLOADS_SCANNED:i,DOWNLOADS_BLOCKED:s}=tn.nativeSettings,o={pagesScanned:t.value||e.pagesScanned,pagesBlocked:n.value||e.pagesBlocked,downloadsScanned:i.value||e.downloadsScanned,downloadsBlocked:s.value||e.downloadsBlocked};tn.localStore.set(p.name,o)}static add(e){const t=this.read();switch(e){case Xt:t.pagesScanned++;break;case Qt:t.pagesBlocked++;break;case Jt:t.downloadsScanned++;break;case Zt:t.downloadsBlocked++;break;default:return}tn.localStore.set(p.name,t)}static read(){const e={pagesScanned:0,pagesBlocked:0,downloadsScanned:0,downloadsBlocked:0},t=tn.localStore.get(p.name);return t&&Object.assign(e,t),e}}const tn={isTrustCheckRequired:!0,ExtensionTelemetryUrl:null,scheduleManager:null,isNativeConnected:!0,telemetryEngine:null,postInstallationPage:"https://www.mcafee.com/consumer/v/wa-how.html",listenerManager:null,firefoxInternalUUID:"",shadowMode:"closed",browserType:v,sessionStore:null,localStore:null,idb:null,ffViewports:null,garbageCollector:null,typoCache:null,logger:null,loglevel:null,messageDispatcher:null,port:null,tabData:new Kt,useNativeLogger:!1,wasm:null,userAgentInBase64:null,typoSquattingServer:Ht,tldParser:null,urlParser:null,trustedDomains:jt,nativeSettings:Ut,searchSuggest:null,ratBlacklist:[{domain:"www.beamyourscreen.com",urls:[]},{domain:"www.connectwise.com",urls:["www.connectwise.com/platform/unified-management/control"]},{domain:"get.gotoassist.com",urls:[]},{domain:"fastsupport.gotoassist.com",urls:[]},{domain:"www.join.me",urls:[]},{domain:"www.mikogo.com",urls:[]},{domain:"www.mikogo.de",urls:[]},{domain:"www.securelink.com",urls:[]},{domain:"join.zoho.com",urls:[]}],preconditions:null,platform:class{static debounce(e,t,n){let i;return(...s)=>{const o=n&&!i;clearTimeout(i),i=setTimeout((()=>{i=null,n||e(...s)}),t),o&&e(...s)}}static isBrowserEN(){return I.i18n.getUILanguage().toLowerCase().startsWith("en")}static isChromeBrowser(){const e=navigator.userAgent.toLowerCase();return!(!e.includes("chrome")||!1==!!chrome)&&(!e.includes("opr")&&!e.includes("edg"))}static isWindowsOS(){const{platform:e}=navigator;return e&&-1!==e.search("Win")}static getPlatform(){const{platform:e}=navigator;let t=f;return-1!==e.search("Mac")?t=w:-1!==e.search("iPhone")&&(t=L),t}}.getPlatform(),wssMessageDispatcher:null,wssNativeClient:null,WSS_INSTALLED:!1,isWPSInstalled:!1,searchEngines:null,enginesVersionUrl:Gt,engineCheckInterval:864e5,ENGINES_VERSION:R,AUTO_PLAY_NOTIFICATION_ENABLED:!1,DLS_POPUP_FOR_WA_NATIVE_ENABLED:!1,WA_EXTN_CONDITION_URL:Yt,ALLOW_LOCALHOST:!1,IDPS_AUTH_URL:"https://csptoken.ccs.mcafee.com/auth/token",IDPS_BREACH_COUNT_URL:"https://identity.unifiedapis.mcafee.com/breach/v1/BreachCount",IDPS_CSP_CLIENT_ID:null,IDPS_IS_ENTITLED:!1,IDPS_PROVISION_ID:null,IDPS_LOGIN_DOMAIN:"https://protection.mcafee.com",UA_CLIENT:null,TYPOSQUATTING_MAX_CACHE:100,TYPOSQUATTING_EXPIRY:2592e6,typosquattingHandler:null,URL_DOWNLOAD_MAX_CACHE:100,URL_DOWNLOAD_EXPIRY:2592e6,WA_IMAGE_SECRET:null,apsUrlList:{shopping:{"www.amazon.com":{paths:["buy/payselect/handlers","buy/addressselect/handlers"]}},email:{"mail.google.com/mail":{selector:"div[role=main] a"},"outlook.live.com/mail":{selector:"div[role=main][aria-label] a"},"outlook.office.com/mail":{selector:"div[role=main][aria-label] a"},"outlook.office365.com/mail":{selector:"div[role=main][aria-label] a"},"mail.yahoo.com":{selector:"div[role=main] ul li a"}}},apsAnimationTimeout:5e3,wpsRequestedSettings:new Set(["SMA_USER_TOGGLE","SEARCH_ANNOTATION_OPTION","SMA_ANNOTATION_OPTIONS"]),permittedContentTypes:["application/vnd.microsoft.portable-executable","application/octet-stream","application/x-msdos-program","application/x-msdownload","binary/octet-stream","application/x-msdownload"],SUPPORTED_WEBSITE_LIST:["protection.mcafee.com","protection-dev-roadhouse-int.dvqa.mcafee.com","protection-dev2-roadhouse-int.dvqa.mcafee.com","protection-qa-roadhouse-int.dvqa.mcafee.com"],mtiRequestor:null,htiServer:qt,cspClientId:"e87c73de-b45e-4427-b590-5124401795b6",sailer:null,sailorConditionUrl:Wt,allTrackerUrl:$t,antitrackData:new class{init(){tn.wssMessageDispatcher?.nativeDispatcher?.getATUpsellFlag((e=>{e?.antitrack_upsell_config?.enabled&&tn.scheduleManager.setEnabled(u.name,!0)}))}isActive(){return!tn.isAntitrackerExtInstalled}isWhiteListed(e,t){return tn.localStore.get(A.name,["mcafee.com"]).some((t=>e.includes(t)))||t.includes("fi")}addCountTo(e,t=1){const n=tn.localStore.get(e,0);tn.localStore.set(e,n+t)}getAndResetCount(e){const t=tn.localStore.get(e,0);return tn.localStore.set(e,0),t}addLatestDomain(e,t){try{this.addCountTo(t);const n=new Date,i=`${n.getFullYear()}${n.getMonth()}${n.getDate()}`,s=new URL(e).hostname.replace("www.",""),o=this.getDomainList();o.dataDate!==i&&(o.dataDate=i,o.domainHistoryMap={}),o.lastVisited=s,o.domainHistoryMap=o.domainHistoryMap||{},(o.domainHistoryMap[s]||Object.keys(o.domainHistoryMap).length<50)&&(o.domainHistoryMap[s]=(o.domainHistoryMap[s]||0)+1),tn.localStore.set(N.name,o)}catch(e){ie.log(`[AntitrackerData] Error adding last domain: ${e.message||e}`)}}getDomainList(){const e=tn.localStore.get(N.name,{});return JSON.parse(JSON.stringify(e))}updateWPS(e){try{e=e?JSON.parse(e):{};const{pagesBlocked:t=0,pagesScanned:n=0}=en.read();let i=0;Object.values(W).forEach((t=>{const n=t.toLowerCase(),s=(e[n]||0)+this.getAndResetCount(t);e[n]=s,i+=s})),e.total_trackers=i,e.blocked_pages=t,e.scanned_pages=n,e.last_visited="",e.domain_history="",0===e.total_trackers&&0===e.blocked_pages&&0===e.scanned_pages&&""===e.last_visited&&""===e.domain_history||!this.isSameAsLastScan(e)&&tn.wssMessageDispatcher&&(tn.wssMessageDispatcher.nativeDispatcher.updateAntitrackerToWPS(e),tn.localStore.set(m.name,e))}catch(e){ie.log(`[AntitrackerData] Error sending AT updates to WPS: ${e.message}`)}}getDomainHistory(e={}){let t="";const n=Object.keys(e);if(0===n.length)return t;n.sort(((t,n)=>e[n]-e[t]));for(let i=0;i<n.length&&i<5&&n[i];i++){const s=n[i];t+=`${s},${e[s]},`}return t.slice(0,-1)}isSameAsLastScan(e){const t=tn.localStore.get(m.name,{}),n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const i of n)if(e[i]!==t[i])return!1;return!0}},isAntitrackerExtInstalled:!1,sendDataToWpsFlag:!1,analyticsContentVersion:"1.0.1",htiReportHandler:null,mockingBirdHandler:null,featureFlagManager:null,featureFlagServer:zt},nn=(d.name,y.name,d.name,E.name,"ADD"),sn="REMOVE",on={ANNOTATION:{},BackgroundIPC:null,BackgroundCommons:null,ContextTelemetry:null,TelemetryEventNames:null,UrlParser:null,Utils:null,Commands:{},CommonConstants:{},extension:null,SearchEngineHelper:null,prevLink:null,Logger:null};class an{static getResString(e,t){on.ANNOTATION.resourceRequestor.getResStr(e,(n=>{n?t(n):on.Logger.error(`Resource string ${e} failed to fetch through resource requestor`)}))}}class rn{static async toHTICategoriesString(e,t=!1){const n=e=>new Promise((t=>{an.getResString(e,(e=>t(e)))})),i=async(e,t)=>{const i={},s=await n(`category_id_${e}_name`);if(i.name=s,t){const t=await n(`category_id_${e}_description`);i.description=t}return i},s=[];for(const n of e)s.push(i(n,t));return await Promise.all(s)}static browserTypeToString(e=!1){let t="";switch(v){case 1:t="FF";break;case 2:t="CH";break;case 3:t="ED";break;case 4:t="SF";break;default:t="UN"}return e?t.toLowerCase():t}static toAnnotationImageClass(e){let t="";switch(rn.toColor(e)){case k:t="green";break;case M:t="red";break;case P:t="yellow";break;case F:t="grey"}return t}static isPhishingURI(e){return e&&e.includes(Vt)}static toBlockState(e){const t=rn.toColor(e);return t===P&&rn.isPhishingURI(e.category)?b.PHISHING:isNaN(t)?b.GREY:t}static toColor(e){let t=B;return e&&void 0!==e.trust?(t=e.trust>=U?k:e.trust>=K?F:e.trust>=V?P:e.trust>=x?M:B,t):t}static toSiteReportUrl(e){return`${I.runtime.getURL("html/site_status_site_report.html")}?url=${escape(e)}`}static isExtensionUrl(e){return e.startsWith(G)}static isAnyExtensionUrl(e){return e.startsWith(`${G.split("://")[0]}://`)}static isSafeUrl(e){return rn.isSiteAdvisorUrl(e)||rn.isExtensionUrl(e)}static isSiteAdvisorUrl(e){return e.startsWith(`http://${xt}`)||e.startsWith(`https://${xt}`)}static isPropertRedirectUrl(e){return rn.isPropertyWebURL(e)||e.startsWith("edge://")||e.startsWith("chrome://")}static isProperWebURL(e=""){return!!(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://"))}static getUINumber(e){if(e>=1e4)return"10k+";if(e>=1e3){let t=(e/1e3).toFixed(1);return t="0"===t.substring(2,3)?t.substring(0,1):t,`${t}k+`}return`${e}`}static hasEpochTimeElapsed(e,t){return(new Date).getTime()/1e3>e+t}static isPersonalPolicyEnabled(){return!0}static isActivityPolicyEnabled(){return!0}static async blockRequest(e,t,n){const i=await I.declarativeNetRequest.getDynamicRules();0===i.filter((e=>e.condition.urlFilter===t)).length&&rn.addDynamicRule(e,t,n,i.length+1,0)}static async addDynamicRule(e,t,n,i,s){if(s>=10)ie.error(`Unable to add dynamic rule for tabId:${e}, on url: ${t}. message: ${n}`);else try{await I.declarativeNetRequest.updateDynamicRules({addRules:[{id:i,condition:{urlFilter:t,resourceTypes:["main_frame"]},action:{type:"block"}}]}),ie.log(`${n} ${t} ${e}`)}catch(o){rn.addDynamicRule(e,t,n,i+1,s+1)}}static async updateExcludedTabInSession(e,t){try{const n=999999,i=(await I.declarativeNetRequest.getSessionRules()).find((e=>e.id===n));let s=i?.condition?.tabIds||[],o=!1;const a=s.indexOf(e);t===nn&&-1===a?(s.push(e),o=!0):t===sn&&-1!==a&&(s=s.filter((t=>t!==e)),o=!0),o&&I.declarativeNetRequest.updateSessionRules({removeRuleIds:[n],addRules:[{id:n,condition:{tabIds:s},action:{type:"allow"}}]})}catch(e){ie.error(e.message)}}static updateHTIGlobalsAfterNativeConnection(){const e=tn.nativeSettings.MTI_CLIENT_ID.value,t=tn.nativeSettings.CSP_ID_SETTING.value,n=tn.nativeSettings.JWT_TOKEN_ENABLED.value;""!==e&&tn.mtiRequestor.setGlobals({clientIdGuid:e}),"__not_available__"!==t&&tn.mtiRequestor.setGlobals({cspid:t}),"boolean"==typeof n&&tn.mtiRequestor.setGlobals({jwtEnabled:n})}static newGuid(){const e=new Uint8Array(24);let t=Date.now().toString()+Math.random().toString().substring(2);for(let n=0;n<24;++n)t+=e[n].toString();let n="{";for(let e=0;e<36;++e)if(8===e||13===e||18===e||23===e)n+="-";else{n+=t[Math.floor(Math.random()*t.length)]}return n+="}",n}}class ln{constructor(e){this._options=e,this.TELEMETRY_HANDLERS=this.initializeTelemetryHandler()}fetchTelemetryHandlers(e){const t=[];return this.TELEMETRY_HANDLERS.forEach((n=>{n.trigger.identifier&&e!==n.trigger.identifier||t.push(n)})),t}initializeTelemetryHandler(){return[{trigger:{identifier:$e,sendTelemetry:this._options.isFromBackground||!1},messages:[{template:{analyticsSDK:!0,name:at,interaction_type:_t,colour:Bt.toTelemetryBlockState(this._options.colour),level:this._options.level,style:"UNKNOWN",_event_name:$e,browser:rn.browserTypeToString()}}]},{trigger:{identifier:$e,sendTelemetry:this._options.isFromForeground||!1},messages:[{template:{analyticsSDK:!0,name:at,interaction_type:ut,colour:Bt.toTelemetryBlockState(this._options.colour),level:this._options.level,style:"UNKNOWN",_event_name:$e,browser:rn.browserTypeToString(),metadata:`url=${this._options.url}`}}]},{trigger:{identifier:$e,selector:"#sidebar-close",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,name:at,interaction_type:Et,colour:Bt.toTelemetryBlockState(this._options.colour),level:this._options.level,style:"UNKNOWN",_event_name:$e,browser:rn.browserTypeToString()}}]},{trigger:{identifier:qe,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,name:st,interaction_type:dt,badge_count:this._options.count,_event_name:qe,browser:rn.browserTypeToString()}}]},{trigger:{identifier:Ye,sendTelemetry:this._options.isFromBackground},messages:[{template:{analyticsSDK:!0,url:this._options.url,browser:rn.browserTypeToString(),_event_name:Ye}}]},{trigger:{identifier:je,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,name:je,interaction_type:_t,tab:Bt.toTelemetrySettingTab(He),_event_name:je,browser:rn.browserTypeToString()}}]},{trigger:{identifier:je,selector:`#${Rt.SETTINGS_TAB_PREFIX}${He}`,action:vt.CLICK},messages:[{template:{analyticsSDK:!0,name:je,interaction_type:_t,tab:Bt.toTelemetrySettingTab(He),_event_name:je,browser:rn.browserTypeToString()}}]},{trigger:{identifier:je,selector:`#${Rt.SETTINGS_TAB_PREFIX}${xe}`,action:vt.CLICK},messages:[{template:{analyticsSDK:!0,name:je,interaction_type:_t,tab:Bt.toTelemetrySettingTab(xe),_event_name:je,browser:rn.browserTypeToString()}}]},{trigger:{identifier:je,selector:`#${Rt.SETTINGS_TAB_PREFIX}${We}`,action:vt.CLICK},messages:[{template:{analyticsSDK:!0,name:je,interaction_type:_t,tab:Bt.toTelemetrySettingTab(We),_event_name:je,browser:rn.browserTypeToString()}}]},{trigger:{identifier:je,selector:`#${Rt.SETTINGS_TAB_PREFIX}${Ge}`,action:vt.CLICK},messages:[{template:{analyticsSDK:!0,name:je,interaction_type:_t,tab:Bt.toTelemetrySettingTab(Ge),_event_name:je,browser:rn.browserTypeToString()}}]},{trigger:{identifier:Qe,sendTelemetry:!0},messages:[{template:{name:rt,search_type:Lt,_event_name:Qe,browser:rn.browserTypeToString(),type_tag:this._options.typeTag,provider_type:this._options.engineName}}]},{trigger:{identifier:Je,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,name:lt,interaction_type:pt.MAIN,_event_name:Je,browser:rn.browserTypeToString()}}]},{trigger:{identifier:Ze,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,name:Ze,block_state:Bt.toTelemetryBlockState(this._options.blockState),site_categories:this._options.siteCategories,url:this._options.displayUrl,_event_name:Ze,browser:rn.browserTypeToString()}}]},{trigger:{identifier:et,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,name:ct,interaction_type:_t,_event_name:et,browser:rn.browserTypeToString(),site:this._options.site,color:Rt.GREEN,count:this._options[Rt.GREEN]}},{template:{analyticsSDK:!0,name:ct,interaction_type:_t,_event_name:et,browser:rn.browserTypeToString(),site:this._options.site,color:Rt.RED,count:this._options[Rt.RED]}},{template:{analyticsSDK:!0,name:ct,interaction_type:_t,_event_name:et,browser:rn.browserTypeToString(),site:this._options.site,color:Rt.YELLOW,count:this._options[Rt.YELLOW]}},{template:{analyticsSDK:!0,name:ct,interaction_type:_t,_event_name:et,browser:rn.browserTypeToString(),site:this._options.site,color:Rt.UNKNOWN,count:this._options[Rt.UNKNOWN]}}]},{trigger:{identifier:tt,sendTelemetry:this._options.isFromBackground},messages:[{template:{analyticsSDK:!0,name:ot,interaction_type:_t,browser:rn.browserTypeToString(),_event_name:tt}}]},{trigger:{identifier:Xe,state:Rt.LOADED,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,name:Xe,interaction_type:_t,browser:rn.browserTypeToString(!0),url:this._options.url,_event_name:Xe}}]},{trigger:{identifier:Xe,selector:"#rat_detection_got_it_btn",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,name:Xe,interaction_type:mt.ACKNOWLEDGED,browser:rn.browserTypeToString(!0),url:this._options.url,_event_name:Xe}}]},{trigger:{identifier:Xe,selector:"#sidebar_rat_detection_whitelist_btn",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,name:Xe,interaction_type:mt.WHITELISTED,browser:rn.browserTypeToString(!0),url:this._options.url,_event_name:Xe}}]},{trigger:{identifier:Xe,selector:"#sidebar-close",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,name:Xe,interaction_type:Et,browser:rn.browserTypeToString(!0),url:this._options.url,_event_name:Xe}}]},{trigger:{identifier:nt,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,_event_name:nt,message:this._options.message}}]},{trigger:{identifier:ze,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,_event_name:ze,category:ze,action_type:this._options.eventAction||Rt.UNKNOWN,browser:"un"===rn.browserTypeToString(!0)?Rt.UNKNOWN:rn.browserTypeToString(!0),count:this._options.count||Rt.UNKNOWN,type:this._options.type,flow_id:this._options.flowId}}]},{trigger:{identifier:it.EVENT_NAME,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,_event_name:it.EVENT_NAME,name:it.EVENT_NAME,action_type:_t,browser:rn.browserTypeToString(!0),type:it.TOAST,sequence:Rt.DEFAULT,trigger:Rt.DEFAULT,color:Rt.DEFAULT}}]},{trigger:{identifier:it.IMPRESSION_BALLOON,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,_event_name:it.EVENT_NAME,name:it.EVENT_NAME,action_type:_t,browser:"un"===rn.browserTypeToString(!0)?Rt.UNKNOWN:rn.browserTypeToString(!0),type:it.BALLOON,sequence:this._options.sequence,trigger:this._options.trigger,color:this._options.color}}]},{trigger:{identifier:it.IMPRESSION_HOVER,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,_event_name:it.EVENT_NAME,name:it.EVENT_NAME,action_type:ht,browser:"un"===rn.browserTypeToString(!0)?Rt.UNKNOWN:rn.browserTypeToString(!0),type:it.BALLOON,sequence:this._options.sequence,trigger:this._options.trigger,color:this._options.color}}]},{trigger:{identifier:it.CLOSE_BALLOON,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,_event_name:it.EVENT_NAME,name:it.EVENT_NAME,action_type:gt,browser:"un"===rn.browserTypeToString(!0)?Rt.UNKNOWN:rn.browserTypeToString(!0),type:it.BALLOON,sequence:this._options.sequence,trigger:this._options.trigger,color:this._options.color}}]},{trigger:{identifier:it.TOAST_CLOSE,sendTelemetry:!0},messages:[{template:{analyticsSDK:!0,_event_name:it.EVENT_NAME,name:it.EVENT_NAME,action_type:this._options.gotItButton?Tt:gt,browser:"un"===rn.browserTypeToString(!0)?Rt.UNKNOWN:rn.browserTypeToString(!0),type:it.TOAST,sequence:Rt.DEFAULT,trigger:Rt.DEFAULT,color:Rt.DEFAULT}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:this._options.isFromActivationPage||!1},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ne,event_id:he.EVENT_ID,screen_name:Pe.ACTIVATION_ENROLLMENT_BANNER,trigger:Fe.AUDIO_PLAYING,action:Ue.NO_ACTION,is_interactive:!1,browser:rn.browserTypeToString(!0),interaction:Ce,display_type:this._options.displayType,message_sequence:this._options.msgSequence,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,selector:"#mb_banner_activate_button",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.ACTIVATION_ENROLLMENT_BANNER,trigger:Fe.ACTIVATE_BTN_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:De,display_type:this._options.displayType,message_sequence:this._options.msgSequence,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,selector:"#mb_banner_learn_more",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.ACTIVATION_ENROLLMENT_BANNER,trigger:Fe.ACTIVATION_LEARM_MORE_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:Oe,display_type:this._options.displayType,message_sequence:this._options.msgSequence,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,selector:"#close_button",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:this._options.screenName,trigger:Fe.X_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:fe,display_type:this._options.displayType,message_sequence:this._options.msgSequence,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:this._options.isFromSuccessPage||!1},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ne,event_id:he.EVENT_ID,screen_name:Pe.ACTIVATION_ENROLLMENT_BANNER_SUCCESS,trigger:Fe.ACTIVATION_ACCEPT,action:Ue.NO_ACTION,is_interactive:!1,browser:rn.browserTypeToString(!0),interaction:Ce,display_type:this._options.displayType,message_sequence:this._options.msgSequence,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:"videoBannerShow"===this._options.originFrom},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ne,event_id:he.EVENT_ID,screen_name:Pe.AI_ANNOTATION_BANNER,trigger:Fe.AUDIO_PLAYING,action:Ue.NO_ACTION,is_interactive:!1,browser:rn.browserTypeToString(!0),interaction:Ce,display_type:this._options.displayType,detection_status:this._options.aiAnnoType,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,selector:this._options.bannerNodeSelector||"",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.AI_ANNOTATION_BANNER,trigger:Fe.ANNO_BANNER_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:De,display_type:this._options.displayType,detection_status:this._options.aiAnnoType,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,selector:this._options.videoBannercloseBtn||"",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.AI_ANNOTATION_BANNER,trigger:Fe.X_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:fe,display_type:this._options.displayType,detection_status:this._options.aiAnnoType,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:"videoBannerHover"===this._options.originFrom},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ne,event_id:he.EVENT_ID,screen_name:Pe.AI_ANNOTATION_BANNER,trigger:Fe.ANNO_BANNER_HOVER,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:Le,display_type:Me.AI_ANNO_HOVER_BANNER,detection_status:this._options.aiAnnoType,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:"videoBannerFadeAway"===this._options.originFrom},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.AI_ANNOTATION_BANNER,trigger:Fe.ANNO_BANNER_FADE_AWAY,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:we,display_type:this._options.displayType,detection_status:Se,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:"dfdSidebarShow"===this._options.originFrom},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ne,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_PANEL,trigger:this._options.initTriggerType,action:Ue.NO_ACTION,is_interactive:!1,browser:rn.browserTypeToString(!0),interaction:Ce,audio_detection_state:this._options.audioDetectionState,time_scanned_minutes:this._options.scannedMinutes,time_flagged_minutes:this._options.flaggedMinutes,deepfake_detected_count:this._options.fakeDetectedCount,snooze_duration:this._options.snoozeDuration,is_trial:this._options.isTrial,days_to_expire:this._options.daysToExpire,graph_error_status:this._options.audioGraphStatus,number_of_days:this._options.totalActivatedDays,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:"snoozeOptionSelected"===this._options.originFrom},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_PANEL,trigger:Fe.SNOOZE_OPTION_SELECTED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:ve,audio_detection_state:this._options.audioDetectionState,time_scanned_minutes:this._options.scannedMinutes,time_flagged_minutes:this._options.flaggedMinutes,deepfake_detected_count:this._options.fakeDetectedCount,snooze_duration:this._options.snoozeDuration,is_trial:this._options.isTrial,days_to_expire:this._options.daysToExpire,graph_error_status:this._options.audioGraphStatus,number_of_days:this._options.totalActivatedDays,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,selector:this._options.buyNowBtn||"",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_PANEL,trigger:this._options.buyNowBtnClickedType,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:De,audio_detection_state:this._options.audioDetectionState,time_scanned_minutes:this._options.scannedMinutes,time_flagged_minutes:this._options.flaggedMinutes,deepfake_detected_count:this._options.fakeDetectedCount,snooze_duration:this._options.snoozeDuration,is_trial:this._options.isTrial,days_to_expire:this._options.daysToExpire,graph_error_status:this._options.audioGraphStatus,number_of_days:this._options.totalActivatedDays,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:"dfdPanelCloseClicked"===this._options.originFrom},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_PANEL,trigger:Fe.X_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:fe,audio_detection_state:this._options.audioDetectionState,time_scanned_minutes:this._options.scannedMinutes,time_flagged_minutes:this._options.flaggedMinutes,deepfake_detected_count:this._options.fakeDetectedCount,snooze_duration:this._options.snoozeDuration,is_trial:this._options.isTrial,days_to_expire:this._options.daysToExpire,graph_error_status:this._options.audioGraphStatus,number_of_days:this._options.totalActivatedDays,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:"dfdToggleBtnClicked"===this._options.originFrom},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_PANEL,trigger:Fe.AUDIO_DETECTION_TOGGLE_BTN_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:this._options.toggleType,audio_detection_state:this._options.audioDetectionState,time_scanned_minutes:this._options.scannedMinutes,time_flagged_minutes:this._options.flaggedMinutes,deepfake_detected_count:this._options.fakeDetectedCount,snooze_duration:this._options.snoozeDuration,is_trial:this._options.isTrial,days_to_expire:this._options.daysToExpire,graph_error_status:this._options.audioGraphStatus,number_of_days:this._options.totalActivatedDays,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,selector:this._options.backToEntryBtn||"",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_PANEL,trigger:Fe.DFD_PANEL_BACK_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:Re,audio_detection_state:this._options.audioDetectionState,time_scanned_minutes:this._options.scannedMinutes,time_flagged_minutes:this._options.flaggedMinutes,deepfake_detected_count:this._options.fakeDetectedCount,snooze_duration:this._options.snoozeDuration,is_trial:this._options.isTrial,days_to_expire:this._options.daysToExpire,graph_error_status:this._options.audioGraphStatus,number_of_days:this._options.totalActivatedDays,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,selector:this._options.mbBasicButton||"",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_PANEL,trigger:Fe.DFD_PANEL_BASICS_BTN_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:Oe,audio_detection_state:this._options.audioDetectionState,time_scanned_minutes:this._options.scannedMinutes,time_flagged_minutes:this._options.flaggedMinutes,deepfake_detected_count:this._options.fakeDetectedCount,snooze_duration:this._options.snoozeDuration,is_trial:this._options.isTrial,days_to_expire:this._options.daysToExpire,graph_error_status:this._options.audioGraphStatus,number_of_days:this._options.totalActivatedDays,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:"dfdFaqSidebarShow"===this._options.originFrom},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ne,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_FAQ_PANEL,trigger:this._options.triggerForMbFaq,action:Ue.NO_ACTION,is_interactive:!1,browser:rn.browserTypeToString(!0),interaction:Ce,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,sendTelemetry:"dfdFaqPanelCloseClicked"===this._options.originFrom},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_FAQ_PANEL,trigger:Fe.X_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:fe,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,selector:this._options.contactSupportLink||"",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_FAQ_PANEL,trigger:Fe.DFD_FAQ_PANEL_SUPPORT_BTN_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:Be,suite_csp_id:this._options.wpsCspClientId}}]},{trigger:{identifier:he.EVENT_NAME,selector:this._options.mbFaqBackBtn||"",action:vt.CLICK},messages:[{template:{analyticsSDK:!0,_event_name:he.EVENT_NAME,type:Ae,event_id:he.EVENT_ID,screen_name:Pe.SIDEBAR_FAQ_PANEL,trigger:Fe.DFD_FAQ_PANEL_BACK_CLICKED,action:Ue.WA_INTERACTION,is_interactive:!0,browser:rn.browserTypeToString(!0),interaction:ke,suite_csp_id:this._options.wpsCspClientId}}]}]}}class cn{static sendTelemetryMessages(t,n){const{sendTelemetry:i}=n.trigger,s=n.trigger.action,o=[vt.CLICK];if(n.trigger.selector&&n.trigger.action)if(t.containerMeta){const e=t.containerMeta.query(n.trigger.selector);e&&e.addEventListener(n.trigger.action,a)}else Y((()=>{const e=document.querySelector(n.trigger.selector);e&&e.addEventListener(n.trigger.action,a)}));else(i||n.trigger.state&&n.trigger.state===t.state)&&a();function a(a){n.messages.forEach((n=>{const r={...n.template},l=i&&(void 0===r.count||0!==r.count);let c=o.includes(s);if(s===vt.KEYDOWN&&t.whitelistedKeys){const e=a.keyCode;c=t.whitelistedKeys.includes(e)}(l||c)&&(t.isFromBackground?tn.messageDispatcher.sendTelemetry(JSON.stringify(r)):le(e,{telemetry:JSON.stringify(r)}))}))}}static handle(e){new ln(e).fetchTelemetryHandlers(e.identifier).forEach((t=>{this.sendTelemetryMessages(e,t)}))}}const _n="AI",dn="NO_AI",pn="FULL_BANNER",En="ON_HOVER",mn="ICON_ONLY",un="afterend",gn="afterbegin";class Tn{constructor(e,t,n,i){this.waImageSecret=n,this.wpsCspClientId=i,this.strConvertor=new _e,this.colors={white:"#FFFFFF",red:"#C01818",black:"#343434"},this.bannerData={[_n]:{bgc:this.colors.red,fontColor:this.colors.white,borderColor:"rgba(255, 255, 255, 0.4)",title:this.strConvertor.localeData("mb_video_banner_AI_audio_title"),closeBtn:`${chrome.runtime.getURL("images/banner/close_icon_white.svg")}?secret=${this.waImageSecret}`,icon:`${chrome.runtime.getURL("images/banner/ai_icon_white.svg")}?secret=${this.waImageSecret}`},[dn]:{bgc:this.colors.white,fontColor:this.colors.black,borderColor:"rgba(110, 110, 110, 0.4)",title:this.strConvertor.localeData("mb_video_banner_no_AI_audio_title"),closeBtn:`${chrome.runtime.getURL("images/banner/close_icon_black.svg")}?secret=${this.waImageSecret}`,icon:`${chrome.runtime.getURL("images/banner/ai_icon_red.svg")}?secret=${this.waImageSecret}`}},this.bannerId=e,this.videoElement=t,this.bannerNode=null,this.payload=null,this.timer=null,this.bannerType=null,this.topParentNode=null,this.isParentDefaultP=!1,this.srcUrl=null,this.bannerDetails=null,this.options={identifier:he.EVENT_NAME,wpsCspClientId:Ve.toTlmWpsCspClientId(i)}}getBannerDetailsByVideoSize(){return this.videoElement.offsetWidth>=1081?(this.options.displayType=Me.AI_ANNO_FULL_BANNER,{fontSize:22,lineHeight:37,bannerH:60,closeBtnH:30,aiIconSize:30,bannerAnimationType:pn}):this.videoElement.offsetWidth>=721?(this.options.displayType=Me.AI_ANNO_HOVER_BANNER,{fontSize:18,lineHeight:28,bannerH:46,closeBtnH:23,aiIconSize:23,bannerAnimationType:En}):this.videoElement.offsetWidth>=481?(this.options.displayType=Me.AI_ANNO_HOVER_BANNER,{fontSize:15,lineHeight:23,bannerH:38,closeBtnH:19,aiIconSize:19,bannerAnimationType:En}):(this.options.displayType=Me.AI_ANNO_ICON_BANNER,{fontSize:15,lineHeight:23,bannerH:38,closeBtnH:19,aiIconSize:19,bannerAnimationType:mn})}init(e,t){this.payload=t,this.bannerType=e,this.bannerDetails=this.getBannerDetailsByVideoSize(),this.injectfont(),this.bannerNode=document.createElement("div"),this.bannerNode.setAttribute("id",`${this.bannerId}`),this.initBannerListeners(),this.setBannerElement(),this.appendBannerToVideoContainer(),window.addEventListener("resize",(()=>{this.updateBannerPosition()}),!1),window.addEventListener("scroll",(()=>{this.updateBannerPosition()}),!1);const{srcurl:n,topurl:i}=this.payload;this.srcUrl=n??i,this.options.originFrom="videoBannerShow",this.options.bannerNodeSelector=`#${this.bannerId}`,this.options.aiAnnoType=e===_n?ye:Se,cn.handle(this.options)}injectfont(){try{const e=chrome.runtime.getURL("css/mcafee_fonts.css"),t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.head.appendChild(t)}catch(e){ie.error(e)}}setBannerElement(){const{fontSize:e,closeBtnH:t,bannerH:i,lineHeight:s,aiIconSize:o,bannerAnimationType:a}=this.bannerDetails,r=this.bannerType;this.bannerType===_n&&le(n,{payload:this.payload});const l=`\n      position: absolute;\n      top: 10px;\n      left: 10px;\n      padding-right: ${a===pn?"8px":"0px"};\n      border-radius: ${i}px;\n      margin: 10px;\n      z-index: 2147483647;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      font-family: McAfeePoppins, Arial !important;\n      opacity: 1;\n      box-shadow: 0 4px 4px 0 rgba(0, 0, 0, 0.2);\n      height: ${i}px;\n      width:  ${i}px;\n      background-color: ${this.bannerData[r].bgc};\n      gap: 3px;\n      overflow: hidden;\n      -webkit-transition: all 0.3s ease-in-out;\n      -moz-transition: all 0.3s ease-in-out;\n      transition: all 0.3s ease-in-out;\n      -webkit-user-select: none;\n      -ms-user-select: none;\n      user-select: none;\n    `;this.bannerNode.style=l;const c=`\n      height: ${o}px;\n      width: ${o}px;\n    `,_=`\n      display: flex;\n      color: ${this.bannerData[r].fontColor}; \n      line-height: ${s}px; \n      font-size: ${e}px; \n      font-weight: 600;\n      text-wrap: nowrap;\n    `,d=`\n      display: flex; \n      align-items: center; \n      border-left: 1px solid ${this.bannerData[r].borderColor};\n      margin: 0px 13px;\n      min-width: ${t}px;\n      min-height: ${t}px;\n    `,p=`\n      <div style='position: relative; height: ${i}px; width: ${i}px;'>\n        <div style='position: absolute; height: ${i}px; width: ${i}px; display: flex; justify-content: center; align-items: center'>\n          <img id='videoBannerIcon' src='${this.bannerData[r].icon}' style='${c}' />\n        </div>\n        <div style='height: ${i}px; width: ${i}px;'></div>\n      </div>\n    `,E=`\n      <div id="videoBannerContentContainer" style='display: flex; align-items: center; opacity: 0;'>\n        <div id='videoBannerTitle' style='${_}'>${this.bannerData[r].title}</div>\n        <div id='videoBannerCloseBtn' style='${d}'>\n          <img src='${this.bannerData[r].closeBtn}' style='padding-left:${e-8}px; height:${t}px;'/>\n        </div>\n      </div>\n    `,m=`${p}${mn!==a?E:""}`;if(this.bannerNode.innerHTML=m,mn!==a){const e=this.bannerNode.querySelector("#videoBannerCloseBtn");e?.addEventListener("click",(e=>{this.options.closeBtnClicked=!0,e.stopPropagation(),this.hideBanner()})),e&&(this.options.videoBannercloseBtn="#videoBannerCloseBtn")}a===pn&&setTimeout((()=>this.animateBanner(!0)),250),this.bannerType===dn&&this.closeBannerOnTimeout(this.bannerType)}initBannerListeners(){this.bannerNode.addEventListener("click",(e=>{e.stopPropagation(),le(t,{mbVideoId:this.payload.id});const{bannerAnimationType:n}=this.bannerDetails;mn===n&&this.hideBanner()})),this.bannerNode.addEventListener("mouseenter",(({currentTarget:e})=>{this.options.displayType===Me.AI_ANNO_HOVER_BANNER&&(this.options.originFrom="videoBannerHover",this.options.bannerNodeSelector="",this.options.videoBannercloseBtn="",cn.handle(this.options)),this.handleMouseEnterLeave("mouseenter",e)})),this.bannerNode.addEventListener("mouseleave",(({currentTarget:e})=>{this.handleMouseEnterLeave("mouseleave",e)}))}handleMouseEnterLeave(e){const{bannerAnimationType:t}=this.bannerDetails;t===En&&this.animateBanner("mouseenter"===e),this.bannerType===dn&&("mouseenter"===e&&clearTimeout(this.timer),"mouseleave"===e&&this.closeBannerOnTimeout(this.bannerType))}animateBanner(e=!0){const{bannerH:t}=this.bannerDetails,n=this.bannerNode.querySelector("#videoBannerContentContainer");n&&(this.bannerNode.style.width=e?`${n.offsetWidth+t}px`:`${t}px`,this.bannerNode.style.paddingRight=e?"8px":"0px",n.style.opacity=e?1:0)}closeBannerOnTimeout(){this.timer=setTimeout((()=>{this.hideBanner(),this.options.aiAnnoType!==Se||this.options.closeBtnClicked||(this.options.originFrom="videoBannerFadeAway",this.options.bannerNodeSelector="",this.options.videoBannercloseBtn="",cn.handle(this.options))}),3e3)}hideBanner(){const{bannerAnimationType:e}=this.bannerDetails;mn!==e&&this.animateBanner(!1),this.fadeOut(this.bannerNode,25,(()=>{this.bannerNode.innerHTML="",this.bannerNode.style.display="none"}))}updateBannerUI(e,t,n){this.srcUrl=t,this.payload=n,clearTimeout(this.timer),this.bannerType=e,this.setBannerElement(),this.updateBannerPosition()}appendBannerToVideoContainer(){this.topParentNode=(e=>{let t=e.parentElement;if(null===t)return e;let n=de(t);const i=de(e);let s=1,o=e;for(;null!==t&&i.top===n.top&&i.left===n.left&&s<3;)s++,o=t,t=t.parentElement,null!==t&&(n=de(t));return o})(this.videoElement),this.isParentDefaultP=["relative","fixed"].includes(window.getComputedStyle(this.topParentNode).getPropertyValue("position")),this.bannerNode.style.top=`${this.isParentDefaultP?10:this.topParentNode.offsetTop}px`,this.bannerNode.style.left=`${this.isParentDefaultP?10:this.topParentNode.offsetLeft}px`;const e="VIDEO"===this.topParentNode.tagName?un:gn;this.topParentNode.insertAdjacentElement(e,this.bannerNode)}fadeIn(e,t,n){this.fadeInTimer=setInterval((()=>{e.style.opacity<1?e.style.opacity+=.2:(clearInterval(this.fadeInTimer),n())}),t)}fadeOut(e,t,n){this.fadeOutTimer=setInterval((()=>{e.style.opacity>0?e.style.opacity-=.2:(clearInterval(this.fadeOutTimer),n())}),t)}updateBannerPosition(){this.bannerNode.style.top=`${this.isParentDefaultP?10:this.topParentNode.offsetTop}px`,this.bannerNode.style.left=`${this.isParentDefaultP?10:this.topParentNode.offsetLeft}px`}closeBanner(){this.bannerNode.innerHTML="",this.bannerNode.style.display="none"}}class hn{constructor(){this.banners={}}showBannerOnVideo(e,t){const{finalresult:n,srcurl:i,topurl:s,waImageSecret:o,wpsCspClientId:a,id:r}=t;if(0===e.offsetWidth||0===e.offsetHeight)return;const l=i??s;if(e.src&&e.src!==l)return void ie.log("[MB:showBannerOnVideo] video src changed, ignoring response from native to show banner.");const c=this.convertToBannerId(r),_=n?_n:dn,{videoBanner:d}=this.getBannerById(c);if(!d){const n=new Tn(c,e,o,a);return n.init(_,t),this.banners[c]={videoElement:e,videoBanner:n},void ie.log(`[MB:showBannerOnVideo] creating banner for bannerId=${c}, videoBanner.srcUrl=${n.srcUrl}`)}d.bannerType!==_?l===d.srcUrl&&_!==_n||(ie.log(`[MB:showBannerOnVideo] already exists, updating UI for bannerId=${c}, updatedUrl=${l}, videoBanner.srcUrl=${d.srcUrl}`),d.updateBannerUI(_,l,t),this.banners[c]={videoElement:e,videoBanner:d}):ie.debug("[MB:showBannerOnVideo] prevent same banner type from showing.")}getBannerById(e){for(const[t,{videoBanner:n}]of Object.entries(this.banners))if(e===t)return{videoBanner:n};return{}}removeBannerFromVideo(e){const t=this.convertToBannerId(e),{videoBanner:n}=this.getBannerById(t);n&&(delete this.banners[t],n.closeBanner())}convertToBannerId(e){return`m${e.replace(/[{} -]/g,"")}`}}(new class extends oe{constructor(){super(i),this.bannerHandler=new hn,this.mockingbirdState=null,this.snoozedFinalResult={}}async main(){this.messageListener()}messageListener(){se("WA",null,(({request:e,sendResponse:t})=>{switch(e.command){case s:{const{payload:n}=e;return this.showBanner(n),t({content:!0}),!0}case o:{const{payload:n}=e;return this.removeBanner(n.id),t({content:!0}),!0}case a:{const{status:t,enabled:n}=e;return this.mockingbirdState={status:t,enabled:n},void(!this.mockingbirdState||this.mockingbirdState.enabled&&this.mockingbirdState.status===q||this.removeAllBanners())}}}))}showBanner(e){try{const{id:t,finalresult:n}=e,{element:i,capturing:s,permissionRequired:o}=window.audioMonitor.getById(t)||{};if(o)return;if(this.mockingbirdState&&(!this.mockingbirdState.enabled||this.mockingbirdState.status!==q))return void(this.mockingbirdState.status===$&&!this.snoozedFinalResult[t]&&n&&(this.snoozedFinalResult[t]=!0));if(e.status&&e.status===$)return void(!this.snoozedFinalResult[t]&&n&&(this.snoozedFinalResult[t]=!0));this.snoozedFinalResult[t]&&(e={...e,finalresult:1},delete this.snoozedFinalResult[t]),(s||n)&&i instanceof HTMLMediaElement?this.bannerHandler.showBannerOnVideo(i,e):(s||n)&&i instanceof HTMLAudioElement||i instanceof HTMLCanvasElement&&this.bannerHandler.showBannerOnVideo(i,e)}catch(e){ie.warn(`[MB] showBanner err, ${e.message}`)}}removeBanner(e){try{this.bannerHandler.removeBannerFromVideo(e),delete this.snoozedFinalResult[e]}catch(e){ie.warn(`[MB] removeBanner err, ${e.message}`)}}removeAllBanners(){(window.audioMonitor.audioInfos||[]).forEach((({id:e=null})=>this.removeBanner(e)))}}).main()})();
//# sourceMappingURL=../sourceMap/chrome/scripts/content_mb_banner.js.map